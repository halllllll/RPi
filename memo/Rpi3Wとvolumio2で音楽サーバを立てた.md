## いきさつ
夏休みにもなってなにもしてないので [^1] ラズパイ3Wで音楽サーバーを作ろうとした。

## やり方
ググれば山のように出てくる先人の記事に沿うだけ。
ふつうによくあるvolumio2を採用した。

## 用意した/する っていうもの
| もの     | 備考 |
|:----------------|:------------------|
|  Raspberry Pi 3 W  |  amazonで適当に購入  |
|  usbキーボードとマウス  |  手持ちに余ってるのがなかったのでわざわざ買った。amazonで適当に欲しいのでいいんじゃないかな  |
| hdmiケーブルとそれつなぐディスプレイ| もってた |
| microSDカードとそれ読み込むUSBリーダー | なかったので適当に購入。カードは流用も考慮してclass10の16GBとした |
| ラズパイのGPIOにつなぐDAC | amazonで適当に2500円くらいのやつ購入。<br>[これ](http://amzn.asia/76pBinV) |
| DACのRCA端子につなげるケーブルとスピーカー| そのへんに転がっていたやつ |
| インターネット | WなのでEthernetケーブル要らん。そもそも探したらもっていなかった|

## 手順
[こちら](http://karaage.hatenadiary.jp/entry/2017/01/20/073000)をそのままなぞっただけの感じ。ありがとうございます。

### ハマりポイント
- そもそもコマンドとか知らんので調べながらやった
- Wの場合（かつわざわざ有線で接続してない場合）、最初の接続はラズパイ自身のホットスポットになる。
<table>
<tr>
    <td>SSID</td>
    <td>password</td>
    <td>security</td>
</tr>
<tr>
    <td>Volumio</td>
    <td>volumio2</td>
    <td>wpa2（たぶん）</td>
</tr>
</table>

で入れる。WebUIで入ったあとは右上の歯車のNETWORKから任意のネットワークを設定

- volumio.localもしくはIPアドレスでブラウザから入れとのこと。火狐つかうと楽に入れた（ちょろめだとふつうにキーワード検索しやがった。設定でなんとかできると思うが
- 最初に日本語設定にするとDAC切り替え時にリブートしなかったりの問題があったので、日本語にするのは後回しにするのがいいかもしれない
- 最近のラズパイはSSHがデフォルトで無効になっているらしい。<br>
<code>touch /boot/ssh</code>でsshって名前の空ファイルを作るといけるらしいので真似したらいけた
- タイムゾーンを設定したいが、最近のラズパイには<code>raspi-config</code>も<code>dpkg-reconfigures</code>もないらしく、ちょっとggる範囲の情報では対応できないっぽい。<br>
<code>timedatectl</code>は使えるので、<br>
<code>sudo timedatectl set-ntp true</code>として適当なNTPサーバから時間情報をとってくるようにする。リブートして<code>date</code>からタイムゾーンがJSTになっているか、現在の時間であっているか確認。再設定の直後だと数十秒のラグがあったので数分くらい時間をおくのがいいのかもしれない（参考までに、ネット速度は54Mb/sであった）
- 順調に動いていたmicroSDを紛失したため最初から作り直したのだが、PCからのWebUI,iOSアプリのvolumio(後述)ともに、<strong>やたらと接続が遅い</strong>、<strong>やたらと操作が重い</strong>という現象に直面した。</br>その後安定したのだが、音楽データUSBメモリを挿しっぱなしにしたままセットアップを行ったせいかもしれない。<strong>セットアップが終わってから音楽データを挿入すべき、かつMy MusicからのRescanは時間がかかるが必ずすべき</strong>、かもしれない

### ハマるかと思ったら全然ハマらなかったポイント
- iTunesで使ってたMusicフォルダの中身をそのまんまUSBメモリにぶっこんでつなげて起動しただけでちゃんと音楽データが読み込まれていた。快適
- （ただし任意のアーティストの楽曲を表示とか任意のBPMの楽曲でプレイリスト作るとか少しだけ高度な設定はデフォルトではできないっぽい。使い勝手は微妙）
    - ただし今流れている楽曲のアーティストの楽曲を表示、はできる。プレイバック画面の左側の経過時間の下の設定っぽいアイコンから（日本語表示で）<strong>アーチストに行く</strong>を選択。精度は不明
- volumio2のDACモデルはHiFiBerry DAC Plusでやれとの情報もあったが今回の環境ではデフォルトのDAC502でいけた
- 一度上記の状態で異なるラズパイにmicroSDを移して再度今回のラズパイに移したらデフォルトがHotSpotになっていたが、WebUIからふつうにネットワークを変更して（「保存」を押すといつまでも画面が切り替わらなかったのだが）ラズパイを再起動するとちゃんと元通りのラズパイのIPアドレスに接続できていた。再起動大事。
- 固定IPは<code>/etc/dhcpcd.conf</code>をいじる、という記事がよくヒットするが、ふつうにWebUIのネットワーク設定からstaticにできる。リブートして<code>sudo /etc/dhcpcd.conf</code>して確認するとちゃんとなっている。指定したIPアドレスが存在しない場合は自動的にHotSpotになる模様。

## わかったこと

一切コード書かずにできるのでわたしみたいに一切コード書けない人には楽であった。また、ハンダ付けはもとより、オームの法則すら忘れてる中学生以下の脳味噌のわたしでも、回路設計や基盤への配線など一切なしでできる程度であった。

## 経過その他
- iOSでvolumioを扱える、その名もvolumioってそのまんまのアプリがあったのでそれを入れている

- 2017/09/07 23:54</br>
  PC上のWebUIでみると文字化けする楽曲がある。ロケールを<code>ja_JP.UTF-8</code>に変更することで対応する
    - <code>sudo dpkg-reconfigure locales</code>でロケールの選択。<code>ja_JP.UTF-8 UTF-8</code>に変更
    - Configuring locales画面が出てくる。<code>ja_JP.UTF-8</code>を選択
    - <code>locale</code>コマンドで確認してみてもよくわからんかったけどとりあえず再起動せずともちゃんと表示されてて直っているっぽい


[^1]: 注文したときにはギリ8/31日で世間的には夏休みといえた
